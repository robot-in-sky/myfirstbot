groups:
  - name: docker-alerts
    rules:
      - alert: DockerContainerDown
        expr: |
          absent(container_last_seen{container_name!=""})
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "Docker container is missing"
          description: "The container '{{ $labels.container_name }}' has not been exposing metrics for more than 1 minute. It might be down."

      - alert: DockerContainerRestarted
        expr: |
          increase(container_restart_count_total{container_name!=""}[5m]) > 0
        for: 1m
        labels:
          severity: warning
        annotations:
          summary: "Docker container restarted"
          description: "The container '{{ $labels.container_name }}' was restarted in the last 5 minutes."

      - alert: ErrorOrCriticalInLogs
        expr: |
          sum by(container_name) (
            count_over_time({container_name!=""} |= "ERROR" or |= "CRITICAL"[5m])
          ) > 0
        for: 30s
        labels:
          severity: warning
        annotations:
          summary: "Error or critical log detected"
          description: "The container '{{ $labels.container_name }}' has logged 'ERROR' or 'CRITICAL' in the past 5 minutes."